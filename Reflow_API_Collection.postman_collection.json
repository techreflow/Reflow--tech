{
  "info": {
    "name": "Reflow Technologies API",
    "description": "Complete API collection for Reflow backend with organization and project management",
    "version": "1.0.0",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "auth": {
    "type": "bearer",
    "bearer": [
      {
        "key": "token",
        "value": "{{auth_token}}",
        "type": "string"
      }
    ]
  },
  "variable": [
    {
      "key": "base_url",
      "value": "https://reflow-backend.fly.dev/api/v1",
      "type": "string"
    },
    {
      "key": "auth_token",
      "value": "",
      "type": "string"
    },
    {
      "key": "user_email",
      "value": "user@example.com",
      "type": "string"
    },
    {
      "key": "organization_id",
      "value": "",
      "type": "string"
    },
    {
      "key": "project_id",
      "value": "",
      "type": "string"
    },
    {
      "key": "member_id",
      "value": "",
      "type": "string"
    },
    {
      "key": "device_id",
      "value": "",
      "type": "string"
    }
  ],
  "item": [
    {
      "name": "Authentication",
      "item": [
        {
          "name": "User Signup",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"{{user_email}}\",\n  \"name\": \"John Doe\",\n  \"password\": \"password123\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/auth/user/signup",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "auth",
                "user",
                "signup"
              ]
            },
            "description": "Register a new user account"
          },
          "response": []
        },
        {
          "name": "User Login",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"{{user_email}}\",\n  \"password\": \"password123\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/auth/user/login",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "auth",
                "user",
                "login"
              ]
            },
            "description": "Login with email and password"
          },
          "response": []
        },
        {
          "name": "Generate OTP",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"{{user_email}}\",\n  \"action\": \"signup\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/auth/user/generate/otp",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "auth",
                "user",
                "generate",
                "otp"
              ]
            },
            "description": "Generate OTP for signup or login verification"
          },
          "response": []
        },
        {
          "name": "Verify OTP",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"{{user_email}}\",\n  \"verificationCode\": \"123456\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/auth/user/verify/otp",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "auth",
                "user",
                "verify",
                "otp"
              ]
            },
            "description": "Verify OTP and get authentication token"
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// Auto-set auth token from response",
                  "if (pm.response.code === 200) {",
                  "    const responseJson = pm.response.json();",
                  "    if (responseJson.data && responseJson.data.token) {",
                  "        pm.collectionVariables.set('auth_token', responseJson.data.token);",
                  "        console.log('Auth token set automatically');",
                  "    }",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ]
        }
      ]
    },
    {
      "name": "Organization Management",
      "item": [
        {
          "name": "Create Organization",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{auth_token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"My Organization\",\n  \"description\": \"This is a sample organization for testing\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/organization",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "organization"
              ]
            },
            "description": "Create a new organization"
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// Auto-set organization ID from response",
                  "if (pm.response.code === 201) {",
                  "    const responseJson = pm.response.json();",
                  "    if (responseJson.data && responseJson.data.organization && responseJson.data.organization.id) {",
                  "        pm.collectionVariables.set('organization_id', responseJson.data.organization.id);",
                  "        console.log('Organization ID set automatically');",
                  "    }",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Get Organization",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{auth_token}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}/organization",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "organization"
              ]
            },
            "description": "Get user's organization details"
          },
          "response": []
        },
        {
          "name": "Invite User to Organization",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{auth_token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"member@example.com\",\n  \"role\": \"MEMBER\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/organization/invite",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "organization",
                "invite"
              ]
            },
            "description": "Invite a user to join the organization"
          },
          "response": []
        },
        {
          "name": "Remove Member from Organization",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{auth_token}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}/organization/member/{{member_id}}",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "organization",
                "member",
                "{{member_id}}"
              ]
            },
            "description": "Remove a member from the organization (owner only)"
          },
          "response": []
        },
        {
          "name": "Leave Organization",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{auth_token}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}/organization/leave",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "organization",
                "leave"
              ]
            },
            "description": "Leave organization (members only, not owners)"
          },
          "response": []
        },
        {
          "name": "Transfer Organization Ownership",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{auth_token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"newOwnerId\": \"{{member_id}}\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/organization/transfer-ownership",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "organization",
                "transfer-ownership"
              ]
            },
            "description": "Transfer organization ownership to an existing member"
          },
          "response": []
        },
        {
          "name": "Get Organization Activities",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{auth_token}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}/organization/activities",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "organization",
                "activities"
              ]
            },
            "description": "Get organization activity log"
          },
          "response": []
        }
      ]
    },
    {
      "name": "Project Management",
      "item": [
        {
          "name": "Get All Projects",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{auth_token}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}/projects",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "projects"
              ]
            },
            "description": "Get all projects in user's organization"
          },
          "response": []
        },
        {
          "name": "Create Project",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{auth_token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"My Project\",\n  \"description\": \"This is a sample project for testing\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/project",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "project"
              ]
            },
            "description": "Create a new project in the organization"
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// Auto-set project ID from response",
                  "if (pm.response.code === 201) {",
                  "    const responseJson = pm.response.json();",
                  "    if (responseJson.data && responseJson.data.project && responseJson.data.project.id) {",
                  "        pm.collectionVariables.set('project_id', responseJson.data.project.id);",
                  "        console.log('Project ID set automatically');",
                  "    }",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Share Project",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{auth_token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"userEmail\": \"member@example.com\",\n  \"role\": \"EDITOR\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/project/{{project_id}}/share",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "project",
                "{{project_id}}",
                "share"
              ]
            },
            "description": "Share project with specific user and role"
          },
          "response": []
        },
        {
          "name": "Delete Project",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{auth_token}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}/project/{{project_id}}",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "project",
                "{{project_id}}"
              ]
            },
            "description": "Delete a project (creator or organization owner only)"
          },
          "response": []
        }
      ]
    },
    {
      "name": "Device Management",
      "item": [
        {
          "name": "Get Project Devices",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{auth_token}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}/project/{{project_id}}/devices",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "project",
                "{{project_id}}",
                "devices"
              ]
            },
            "description": "Get all devices in a project (viewers and above can access)"
          },
          "response": []
        },
        {
          "name": "Get Device Details",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{auth_token}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}/device/{{device_id}}",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "device",
                "{{device_id}}"
              ]
            },
            "description": "Get details of a specific device"
          },
          "response": []
        },
        {
          "name": "Create Device",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{auth_token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"serialNumber\": \"AX601\",\n  \"subscriptionKey\": \"your-subscription-key\",\n  \"name\": \"Temperature Sensor\",\n  \"description\": \"IoT temperature monitoring device\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/project/{{project_id}}/device",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "project",
                "{{project_id}}",
                "device"
              ]
            },
            "description": "Add a new device to a project (editor access or above required)"
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// Auto-set device ID from response",
                  "if (pm.response.code === 201) {",
                  "    const responseJson = pm.response.json();",
                  "    if (responseJson.data && responseJson.data.device && responseJson.data.device.id) {",
                  "        pm.collectionVariables.set('device_id', responseJson.data.device.id);",
                  "        console.log('Device ID set automatically');",
                  "    }",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Update Device",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{auth_token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Updated Temperature Sensor\",\n  \"description\": \"Updated IoT temperature monitoring device with new features\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/device/{{device_id}}",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "device",
                "{{device_id}}"
              ]
            },
            "description": "Update device information (editor access or above required)"
          },
          "response": []
        },
        {
          "name": "Move Device Between Projects",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{auth_token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"newProjectId\": \"{{project_id}}\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/device/{{device_id}}/move",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "device",
                "{{device_id}}",
                "move"
              ]
            },
            "description": "Move device to another project within the same organization"
          },
          "response": []
        },
        {
          "name": "Delete Device",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{auth_token}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}/device/{{device_id}}",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "device",
                "{{device_id}}"
              ]
            },
            "description": "Delete a device (editor access or above required)"
          },
          "response": []
        }
      ]
    },
    {
      "name": "Health & System",
      "item": [
        {
          "name": "Health Check",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/health",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "health"
              ]
            },
            "description": "Check API health status"
          },
          "response": [] 
        },
        {
          "name": "API Root",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "http://localhost:3000/",
              "protocol": "http",
              "host": [
                "localhost"
              ],
              "port": "3000",
              "path": [
                ""
              ]
            },
            "description": "Get API root information"
          },
          "response": []
        }
      ]
    }
  ],
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "type": "text/javascript",
        "exec": [
          "// Global pre-request script",
          "console.log('Making request to:', pm.request.url.toString());"
        ]
      }
    },
    {
      "listen": "test",
      "script": {
        "type": "text/javascript",
        "exec": [
          "// Global test script",
          "pm.test('Status code is not 5xx', function () {",
          "    pm.expect(pm.response.code).to.be.below(500);",
          "});",
          "",
          "pm.test('Response time is less than 5000ms', function () {",
          "    pm.expect(pm.response.responseTime).to.be.below(5000);",
          "});",
          "",
          "// Log response for debugging",
          "console.log('Response Status:', pm.response.status);",
          "console.log('Response Time:', pm.response.responseTime + 'ms');"
        ]
      }
    }
  ]
}
